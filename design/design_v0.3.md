# 项目管理系统增量设计 v0.3

## 新增功能：快速添加事项

### 功能描述
在顶部导航栏「项目管理系统」标题旁边添加一个快速添加按钮，点击后弹出快速添加事项的模态框，用户可以快速创建事项并选择所属分类和项目。

### UI设计

#### 导航栏布局调整
```
[项目管理系统] [+ 快速添加]  |  [分类管理] [每周视图] [周报生成]
```

- 在「项目管理系统」文字右侧添加一个「+ 快速添加」按钮
- 按钮样式：
  - 使用「+」图标 + 文字的组合
  - 突出显示（如：使用主题色背景）
  - 悬停时有视觉反馈

#### 快速添加模态框设计

**模态框标题**: 快速添加事项

**表单字段**（按显示顺序）:

1. **标题** (必填)
   - 输入框类型：单行文本
   - 占位符：请输入事项标题

2. **分类** (必填)
   - 输入框类型：下拉选择
   - 默认值：当前所在分类（如果在分类/项目视图）
   - 选项：从数据库加载所有分类

3. **项目** (必填)
   - 输入框类型：下拉选择
   - 默认值：所选分类的默认「杂」项目
   - 选项：根据所选分类动态加载该分类下的所有项目
   - 联动关系：当分类改变时，项目下拉框自动更新

4. **优先级** (必填)
   - 输入框类型：下拉选择或单选按钮组
   - 默认值：p2
   - 选项：p0（高）、p1（中）、p2（低）
   - 视觉区分：使用颜色标识（p0-红色、p1-橙色、p2-蓝色）

5. **状态** (必填)
   - 输入框类型：下拉选择或单选按钮组
   - 默认值：todo
   - 选项：todo、doing、backlog

6. **计划周次** (可选)
   - 输入框类型：周次选择器
   - 默认值：当前周
   - 格式：wk{周次}，如 wk47

7. **描述** (可选)
   - 输入框类型：多行文本框
   - 占位符：请输入事项详细描述（可选）
   - 行数：3-5行

**操作按钮**:
- 主按钮：创建事项
- 次按钮：取消

### 交互行为

#### 打开模态框
- 点击导航栏的「+ 快速添加」按钮
- 全局快捷键：可考虑支持 `Ctrl/Cmd + N`

#### 智能默认值
- 如果用户当前在某个分类详情页，默认选中该分类
- 如果用户当前在某个项目详情页，默认选中该分类和项目
- 如果用户在每周视图，默认周次为当前周

#### 分类-项目联动
```javascript
// 伪代码示例
onCategoryChange(categoryId) {
  // 1. 加载该分类下的所有项目
  const projects = await fetchProjectsByCategory(categoryId);
  
  // 2. 更新项目下拉框选项
  updateProjectOptions(projects);
  
  // 3. 自动选中默认项目（is_default=true）
  const defaultProject = projects.find(p => p.is_default);
  selectProject(defaultProject.id);
}
```

#### 表单验证
- 标题不能为空
- 分类必须选择
- 项目必须选择
- 提交前验证所有必填项

#### 提交后行为
- 成功创建后：
  - 显示成功提示（Toast）
  - 关闭模态框
  - 如果当前在相关视图（如该分类/项目的详情页），刷新列表
  - 可选：提供「继续添加」选项，保持模态框打开并清空表单
- 失败时：
  - 显示错误信息
  - 保持模态框打开，保留用户输入

### API接口调整

使用现有的 `POST /api/tasks` 接口，无需新增接口。

请求体示例：
```json
{
  "title": "优化数据库查询性能",
  "description": "分析慢查询日志，优化索引",
  "category_id": 1,
  "project_id": 3,
  "priority": "p1",
  "status": "todo",
  "week_number": 47,
  "progress": 0
}
```

### 技术实现要点

#### 前端实现
1. **模态框组件**
   - 可复用的 Modal 组件
   - 使用原生 JavaScript 实现
   - 背景遮罩层（点击关闭可配置）

2. **表单处理**
   - 表单数据绑定
   - 实时验证
   - 错误提示展示

3. **分类-项目联动**
   - 监听分类选择变化
   - 动态加载项目列表
   - 自动选中默认项目

4. **周次选择器**
   - 可以使用输入框 + 格式验证
   - 或使用下拉框提供最近几周的选项

#### 数据库
使用现有表结构，无需修改。

### 用户体验优化

1. **快捷访问**
   - 任何页面都可以快速添加事项
   - 减少操作步骤（相比进入特定项目再添加）

2. **智能上下文**
   - 根据当前页面自动填充分类/项目
   - 减少用户选择操作

3. **键盘支持**
   - Tab 键切换输入项
   - Enter 键提交（在非多行文本框时）
   - Esc 键取消

4. **视觉反馈**
   - 按钮悬停效果
   - 表单验证即时反馈
   - 提交成功的动画提示

### 未来扩展（可选）

1. **模板功能**
   - 保存常用事项模板
   - 快速套用模板创建事项

2. **批量添加**
   - 支持一次性添加多个相似事项
   - 提供「保存并继续」选项

3. **最近使用**
   - 记住最近使用的分类/项目组合
   - 提供快速选择

4. **自动补全**
   - 标题输入时提供历史相似事项建议
   - 避免重复创建
